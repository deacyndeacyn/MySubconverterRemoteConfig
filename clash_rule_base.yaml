mixed-port: 7890
allow-lan: true
mode: rule
log-level: info
ipv6: true
unified-delay: false  # 开启统一延迟时，会计算 RTT，以消除连接握手等带来的不同类型节点的延迟差异，（不使用统一延迟检测，有些节点前戏太慢了）
tcp-concurrent: true  # TCP并发 如果解析出多个ip，同时对所有ip进行连接，返回延迟最低的地址

tun:
  enable: true
  stack: mixed
  dns-hijack:
    - "any:53"
    - "tcp://any:53"
  auto-route: true
  auto-redirect: true
  auto-detect-interface: true
  strict-route: true

sniffer:
  enable: true
  sniff:
    HTTP:
      ports: [80, 8080-8880]
      override-destination: true
    TLS:
      ports: [443, 8443]
    QUIC:
      ports: [443, 8443]
  skip-domain:
    - "Mijia Cloud"
    - "+.push.apple.com"

dns:
  enable: true
  listen: 0.0.0.0:1053
  ipv6: true
  
  enhanced-mode: fake-ip  # fake-ip/redir-host
  fake-ip-range: 198.18.0.1/16
  fake-ip-filter:  # fakeip 过滤，以下地址不会下发 fakeip 映射用于连接
    - 'geosite:connectivity-check'
    - 'geosite:private'
    - '*.jianguoyun.com'  # 坚果云
    - 'weatherapi.market.xiaomi.com'  # 小米天气

  default-nameserver:  #基础DNS服务器，必须先有它才能使用域名类型的DNS配置，因此必须为IP，此处使用阿里云DNS
    - 223.5.5.5  # a
    - 119.29.29.29  # a
  nameserver:  #在访问的国外网站没有匹配到任何域名规则，最终走了MATCH兜底规则时使用的DNS，为了确保不发生DNS泄漏和DNS污染，必须使用国外DNS
    - https://cloudflare-dns.com/dns-query  # cf
    - https://dns.google/dns-query  # google
  proxy-server-nameserver:  #解析代理节点时使用的DNS，为了使下面的respect-rules生效必须设置，最好设置为国内DNS，否则在代理的第一步就可能因为连接不上国外DNS而解析不出代理节点的IP，最终倒在起点
    - 223.5.5.5  # a
    - 119.29.29.29  # t
  direct-nameserver:  #规则匹配到直连时使用的DNS，既然是可以直连的，当然要用国内DNS
    - 223.5.5.5  # a
    - 119.29.29.29  # t
  respect-rules: true  #让连接DNS服务器时能够遵循规则，也就是通过代理节点连接到上面设置的国外DNS，因为直连可能连接不上
